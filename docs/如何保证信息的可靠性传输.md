# 如何保证信息的可靠性传输(高可靠)

## 消息持久化机制

消息在发送前会先持久化到数据库的 message 表中
每条消息都有唯一的 seq（序列号），通过事务操作保证 seq 的一致性
即使服务挂掉，消息也已经存储在数据库中，可以恢复

## ACK 确认机制

客户端收到消息后会发送 ACK 给 connect 服务器
connect 服务器将 ACK 传给 logic 服务器
通过 Redis hash 存储 ACK 信息，记录每个设备的消息接收状态
这样可以知道哪些消息未送达，需要重发

## 多设备同步机制

系统会给用户的所有在线设备发送消息
每个设备都有独立的 ACK 确认
保证了消息在多设备间的可靠同步

## 服务高可用保证

connect层和logic层的分离设计使得即使某个connect节点挂掉，只影响该节点的连接
其他 connect 节点仍然可以正常工作
logic层的集中部署保证了数据的一致性

## 消息重发机制

通过比对消息 seq 和 ACK 状态
可以识别出哪些消息未送达
系统可以针对未收到 ACK 的消息进行重发
